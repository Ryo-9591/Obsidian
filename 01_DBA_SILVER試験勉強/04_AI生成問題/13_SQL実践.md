# SQL実践

## 問題1
以下のテーブル構造がある場合、部署ごとの平均給与を求めるSQL文として正しいものを1つ選びなさい。

```sql
EMPLOYEES (EMPLOYEE_ID, FIRST_NAME, LAST_NAME, SALARY, DEPARTMENT_ID)
DEPARTMENTS (DEPARTMENT_ID, DEPARTMENT_NAME)
```

1. ```sql
   SELECT d.DEPARTMENT_NAME, AVG(e.SALARY)
   FROM EMPLOYEES e, DEPARTMENTS d
   WHERE e.DEPARTMENT_ID = d.DEPARTMENT_ID
   GROUP BY d.DEPARTMENT_NAME;
   ```

2. ```sql
   SELECT d.DEPARTMENT_NAME, AVG(e.SALARY)
   FROM EMPLOYEES e
   JOIN DEPARTMENTS d ON e.DEPARTMENT_ID = d.DEPARTMENT_ID
   GROUP BY d.DEPARTMENT_NAME;
   ```

3. ```sql
   SELECT d.DEPARTMENT_NAME, AVG(e.SALARY)
   FROM EMPLOYEES e
   LEFT JOIN DEPARTMENTS d ON e.DEPARTMENT_ID = d.DEPARTMENT_ID
   GROUP BY d.DEPARTMENT_NAME;
   ```

4. ```sql
   SELECT d.DEPARTMENT_NAME, AVG(e.SALARY)
   FROM EMPLOYEES e
   RIGHT JOIN DEPARTMENTS d ON e.DEPARTMENT_ID = d.DEPARTMENT_ID
   GROUP BY d.DEPARTMENT_NAME;
   ```

## 問題2
以下のテーブル構造がある場合、給与が部署の平均給与より高い社員を抽出するSQL文として正しいものを2つ選びなさい。

```sql
EMPLOYEES (EMPLOYEE_ID, FIRST_NAME, LAST_NAME, SALARY, DEPARTMENT_ID)
DEPARTMENTS (DEPARTMENT_ID, DEPARTMENT_NAME)
```

1. ```sql
   SELECT e.EMPLOYEE_ID, e.FIRST_NAME, e.LAST_NAME, e.SALARY
   FROM EMPLOYEES e
   WHERE e.SALARY > (
       SELECT AVG(SALARY)
       FROM EMPLOYEES
       WHERE DEPARTMENT_ID = e.DEPARTMENT_ID
   );
   ```

2. ```sql
   SELECT e.EMPLOYEE_ID, e.FIRST_NAME, e.LAST_NAME, e.SALARY
   FROM EMPLOYEES e
   JOIN (
       SELECT DEPARTMENT_ID, AVG(SALARY) AS AVG_SALARY
       FROM EMPLOYEES
       GROUP BY DEPARTMENT_ID
   ) d ON e.DEPARTMENT_ID = d.DEPARTMENT_ID
   WHERE e.SALARY > d.AVG_SALARY;
   ```

3. ```sql
   SELECT e.EMPLOYEE_ID, e.FIRST_NAME, e.LAST_NAME, e.SALARY
   FROM EMPLOYEES e
   WHERE e.SALARY > (
       SELECT AVG(SALARY)
       FROM EMPLOYEES
   );
   ```

4. ```sql
   SELECT e.EMPLOYEE_ID, e.FIRST_NAME, e.LAST_NAME, e.SALARY
   FROM EMPLOYEES e
   JOIN DEPARTMENTS d ON e.DEPARTMENT_ID = d.DEPARTMENT_ID
   WHERE e.SALARY > (
       SELECT AVG(SALARY)
       FROM EMPLOYEES
       WHERE DEPARTMENT_ID = e.DEPARTMENT_ID
   );
   ```

5. ```sql
   SELECT e.EMPLOYEE_ID, e.FIRST_NAME, e.LAST_NAME, e.SALARY
   FROM EMPLOYEES e
   WHERE e.SALARY > (
       SELECT AVG(SALARY)
       FROM EMPLOYEES
       GROUP BY DEPARTMENT_ID
   );
   ```

## 問題3
以下のテーブル構造がある場合、各部署の給与の合計が1000000を超える部署を抽出するSQL文として正しいものを1つ選びなさい。

```sql
EMPLOYEES (EMPLOYEE_ID, FIRST_NAME, LAST_NAME, SALARY, DEPARTMENT_ID)
DEPARTMENTS (DEPARTMENT_ID, DEPARTMENT_NAME)
```

1. ```sql
   SELECT d.DEPARTMENT_NAME, SUM(e.SALARY)
   FROM EMPLOYEES e
   JOIN DEPARTMENTS d ON e.DEPARTMENT_ID = d.DEPARTMENT_ID
   GROUP BY d.DEPARTMENT_NAME
   HAVING SUM(e.SALARY) > 1000000;
   ```

2. ```sql
   SELECT d.DEPARTMENT_NAME, SUM(e.SALARY)
   FROM EMPLOYEES e
   JOIN DEPARTMENTS d ON e.DEPARTMENT_ID = d.DEPARTMENT_ID
   WHERE SUM(e.SALARY) > 1000000
   GROUP BY d.DEPARTMENT_NAME;
   ```

3. ```sql
   SELECT d.DEPARTMENT_NAME, SUM(e.SALARY)
   FROM EMPLOYEES e
   JOIN DEPARTMENTS d ON e.DEPARTMENT_ID = d.DEPARTMENT_ID
   GROUP BY d.DEPARTMENT_NAME
   WHERE SUM(e.SALARY) > 1000000;
   ```

4. ```sql
   SELECT d.DEPARTMENT_NAME, SUM(e.SALARY)
   FROM EMPLOYEES e
   JOIN DEPARTMENTS d ON e.DEPARTMENT_ID = d.DEPARTMENT_ID
   HAVING SUM(e.SALARY) > 1000000
   GROUP BY d.DEPARTMENT_NAME;
   ```

## 問題4
以下のテーブル構造がある場合、各部署の給与の合計が1000000を超える部署の社員数を抽出するSQL文として正しいものを2つ選びなさい。

```sql
EMPLOYEES (EMPLOYEE_ID, FIRST_NAME, LAST_NAME, SALARY, DEPARTMENT_ID)
DEPARTMENTS (DEPARTMENT_ID, DEPARTMENT_NAME)
```

1. ```sql
   SELECT d.DEPARTMENT_NAME, COUNT(e.EMPLOYEE_ID)
   FROM EMPLOYEES e
   JOIN DEPARTMENTS d ON e.DEPARTMENT_ID = d.DEPARTMENT_ID
   GROUP BY d.DEPARTMENT_NAME
   HAVING SUM(e.SALARY) > 1000000;
   ```

2. ```sql
   SELECT d.DEPARTMENT_NAME, COUNT(e.EMPLOYEE_ID)
   FROM EMPLOYEES e
   JOIN DEPARTMENTS d ON e.DEPARTMENT_ID = d.DEPARTMENT_ID
   WHERE d.DEPARTMENT_ID IN (
       SELECT DEPARTMENT_ID
       FROM EMPLOYEES
       GROUP BY DEPARTMENT_ID
       HAVING SUM(SALARY) > 1000000
   )
   GROUP BY d.DEPARTMENT_NAME;
   ```

3. ```sql
   SELECT d.DEPARTMENT_NAME, COUNT(e.EMPLOYEE_ID)
   FROM EMPLOYEES e
   JOIN DEPARTMENTS d ON e.DEPARTMENT_ID = d.DEPARTMENT_ID
   GROUP BY d.DEPARTMENT_NAME
   WHERE SUM(e.SALARY) > 1000000;
   ```

4. ```sql
   SELECT d.DEPARTMENT_NAME, COUNT(e.EMPLOYEE_ID)
   FROM EMPLOYEES e
   JOIN DEPARTMENTS d ON e.DEPARTMENT_ID = d.DEPARTMENT_ID
   HAVING SUM(e.SALARY) > 1000000
   GROUP BY d.DEPARTMENT_NAME;
   ```

5. ```sql
   SELECT d.DEPARTMENT_NAME, COUNT(e.EMPLOYEE_ID)
   FROM EMPLOYEES e
   JOIN DEPARTMENTS d ON e.DEPARTMENT_ID = d.DEPARTMENT_ID
   GROUP BY d.DEPARTMENT_NAME
   HAVING COUNT(e.EMPLOYEE_ID) > 1000000;
   ```

## 問題5
以下のテーブル構造がある場合、各部署の給与の合計が1000000を超える部署の社員数を抽出するSQL文として正しいものを1つ選びなさい。

```sql
EMPLOYEES (EMPLOYEE_ID, FIRST_NAME, LAST_NAME, SALARY, DEPARTMENT_ID)
DEPARTMENTS (DEPARTMENT_ID, DEPARTMENT_NAME)
```

1. ```sql
   SELECT d.DEPARTMENT_NAME, COUNT(e.EMPLOYEE_ID)
   FROM EMPLOYEES e
   JOIN DEPARTMENTS d ON e.DEPARTMENT_ID = d.DEPARTMENT_ID
   GROUP BY d.DEPARTMENT_NAME
   HAVING SUM(e.SALARY) > 1000000;
   ```

2. ```sql
   SELECT d.DEPARTMENT_NAME, COUNT(e.EMPLOYEE_ID)
   FROM EMPLOYEES e
   JOIN DEPARTMENTS d ON e.DEPARTMENT_ID = d.DEPARTMENT_ID
   WHERE d.DEPARTMENT_ID IN (
       SELECT DEPARTMENT_ID
       FROM EMPLOYEES
       GROUP BY DEPARTMENT_ID
       HAVING SUM(SALARY) > 1000000
   )
   GROUP BY d.DEPARTMENT_NAME;
   ```

3. ```sql
   SELECT d.DEPARTMENT_NAME, COUNT(e.EMPLOYEE_ID)
   FROM EMPLOYEES e
   JOIN DEPARTMENTS d ON e.DEPARTMENT_ID = d.DEPARTMENT_ID
   GROUP BY d.DEPARTMENT_NAME
   WHERE SUM(e.SALARY) > 1000000;
   ```

4. ```sql
   SELECT d.DEPARTMENT_NAME, COUNT(e.EMPLOYEE_ID)
   FROM EMPLOYEES e
   JOIN DEPARTMENTS d ON e.DEPARTMENT_ID = d.DEPARTMENT_ID
   HAVING SUM(e.SALARY) > 1000000
   GROUP BY d.DEPARTMENT_NAME;
   ``` 