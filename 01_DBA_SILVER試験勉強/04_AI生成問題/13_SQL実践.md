# SQL実践

## 問題1
以下のテーブル構造がある場合、部署ごとの平均給与を求めるSQL文として正しいものを1つ選びなさい。

```sql
EMPLOYEES (EMPLOYEE_ID, FIRST_NAME, LAST_NAME, SALARY, DEPARTMENT_ID)
DEPARTMENTS (DEPARTMENT_ID, DEPARTMENT_NAME)
```

1. ```sql
   SELECT d.DEPARTMENT_NAME, AVG(e.SALARY)
   FROM EMPLOYEES e, DEPARTMENTS d
   WHERE e.DEPARTMENT_ID = d.DEPARTMENT_ID
   GROUP BY d.DEPARTMENT_NAME;
   ```

2. ```sql
   SELECT d.DEPARTMENT_NAME, AVG(e.SALARY)
   FROM EMPLOYEES e
   JOIN DEPARTMENTS d ON e.DEPARTMENT_ID = d.DEPARTMENT_ID
   GROUP BY d.DEPARTMENT_NAME;
   ```

3. ```sql
   SELECT d.DEPARTMENT_NAME, AVG(e.SALARY)
   FROM EMPLOYEES e
   LEFT JOIN DEPARTMENTS d ON e.DEPARTMENT_ID = d.DEPARTMENT_ID
   GROUP BY d.DEPARTMENT_NAME;
   ```

4. ```sql
   SELECT d.DEPARTMENT_NAME, AVG(e.SALARY)
   FROM EMPLOYEES e
   RIGHT JOIN DEPARTMENTS d ON e.DEPARTMENT_ID = d.DEPARTMENT_ID
   GROUP BY d.DEPARTMENT_NAME;
   ```

## 問題2
以下のテーブル構造がある場合、給与が部署の平均給与より高い社員を抽出するSQL文として正しいものを2つ選びなさい。

```sql
EMPLOYEES (EMPLOYEE_ID, FIRST_NAME, LAST_NAME, SALARY, DEPARTMENT_ID)
DEPARTMENTS (DEPARTMENT_ID, DEPARTMENT_NAME)
```

1. ```sql
   SELECT e.EMPLOYEE_ID, e.FIRST_NAME, e.LAST_NAME, e.SALARY
   FROM EMPLOYEES e
   WHERE e.SALARY > (
       SELECT AVG(SALARY)
       FROM EMPLOYEES
       WHERE DEPARTMENT_ID = e.DEPARTMENT_ID
   );
   ```

2. ```sql
   SELECT e.EMPLOYEE_ID, e.FIRST_NAME, e.LAST_NAME, e.SALARY
   FROM EMPLOYEES e
   JOIN (
       SELECT DEPARTMENT_ID, AVG(SALARY) AS AVG_SALARY
       FROM EMPLOYEES
       GROUP BY DEPARTMENT_ID
   ) d ON e.DEPARTMENT_ID = d.DEPARTMENT_ID
   WHERE e.SALARY > d.AVG_SALARY;
   ```

3. ```sql
   SELECT e.EMPLOYEE_ID, e.FIRST_NAME, e.LAST_NAME, e.SALARY
   FROM EMPLOYEES e
   WHERE e.SALARY > (
       SELECT AVG(SALARY)
       FROM EMPLOYEES
   );
   ```

4. ```sql
   SELECT e.EMPLOYEE_ID, e.FIRST_NAME, e.LAST_NAME, e.SALARY
   FROM EMPLOYEES e
   JOIN DEPARTMENTS d ON e.DEPARTMENT_ID = d.DEPARTMENT_ID
   WHERE e.SALARY > (
       SELECT AVG(SALARY)
       FROM EMPLOYEES
       WHERE DEPARTMENT_ID = e.DEPARTMENT_ID
   );
   ```

5. ```sql
   SELECT e.EMPLOYEE_ID, e.FIRST_NAME, e.LAST_NAME, e.SALARY
   FROM EMPLOYEES e
   WHERE e.SALARY > (
       SELECT AVG(SALARY)
       FROM EMPLOYEES
       GROUP BY DEPARTMENT_ID
   );
   ```

## 問題3
以下のテーブル構造がある場合、各部署の給与の合計が1000000を超える部署を抽出するSQL文として正しいものを1つ選びなさい。

```sql
EMPLOYEES (EMPLOYEE_ID, FIRST_NAME, LAST_NAME, SALARY, DEPARTMENT_ID)
DEPARTMENTS (DEPARTMENT_ID, DEPARTMENT_NAME)
```

1. ```sql
   SELECT d.DEPARTMENT_NAME, SUM(e.SALARY)
   FROM EMPLOYEES e
   JOIN DEPARTMENTS d ON e.DEPARTMENT_ID = d.DEPARTMENT_ID
   GROUP BY d.DEPARTMENT_NAME
   HAVING SUM(e.SALARY) > 1000000;
   ```

2. ```sql
   SELECT d.DEPARTMENT_NAME, SUM(e.SALARY)
   FROM EMPLOYEES e
   JOIN DEPARTMENTS d ON e.DEPARTMENT_ID = d.DEPARTMENT_ID
   WHERE SUM(e.SALARY) > 1000000
   GROUP BY d.DEPARTMENT_NAME;
   ```

3. ```sql
   SELECT d.DEPARTMENT_NAME, SUM(e.SALARY)
   FROM EMPLOYEES e
   JOIN DEPARTMENTS d ON e.DEPARTMENT_ID = d.DEPARTMENT_ID
   GROUP BY d.DEPARTMENT_NAME
   WHERE SUM(e.SALARY) > 1000000;
   ```

4. ```sql
   SELECT d.DEPARTMENT_NAME, SUM(e.SALARY)
   FROM EMPLOYEES e
   JOIN DEPARTMENTS d ON e.DEPARTMENT_ID = d.DEPARTMENT_ID
   HAVING SUM(e.SALARY) > 1000000
   GROUP BY d.DEPARTMENT_NAME;
   ```

## 問題4
以下のテーブル構造がある場合、各部署の給与の合計が1000000を超える部署の社員数を抽出するSQL文として正しいものを2つ選びなさい。

```sql
EMPLOYEES (EMPLOYEE_ID, FIRST_NAME, LAST_NAME, SALARY, DEPARTMENT_ID)
DEPARTMENTS (DEPARTMENT_ID, DEPARTMENT_NAME)
```

1. ```sql
   SELECT d.DEPARTMENT_NAME, COUNT(e.EMPLOYEE_ID)
   FROM EMPLOYEES e
   JOIN DEPARTMENTS d ON e.DEPARTMENT_ID = d.DEPARTMENT_ID
   GROUP BY d.DEPARTMENT_NAME
   HAVING SUM(e.SALARY) > 1000000;
   ```

2. ```sql
   SELECT d.DEPARTMENT_NAME, COUNT(e.EMPLOYEE_ID)
   FROM EMPLOYEES e
   JOIN DEPARTMENTS d ON e.DEPARTMENT_ID = d.DEPARTMENT_ID
   WHERE d.DEPARTMENT_ID IN (
       SELECT DEPARTMENT_ID
       FROM EMPLOYEES
       GROUP BY DEPARTMENT_ID
       HAVING SUM(SALARY) > 1000000
   )
   GROUP BY d.DEPARTMENT_NAME;
   ```

3. ```sql
   SELECT d.DEPARTMENT_NAME, COUNT(e.EMPLOYEE_ID)
   FROM EMPLOYEES e
   JOIN DEPARTMENTS d ON e.DEPARTMENT_ID = d.DEPARTMENT_ID
   GROUP BY d.DEPARTMENT_NAME
   WHERE SUM(e.SALARY) > 1000000;
   ```

4. ```sql
   SELECT d.DEPARTMENT_NAME, COUNT(e.EMPLOYEE_ID)
   FROM EMPLOYEES e
   JOIN DEPARTMENTS d ON e.DEPARTMENT_ID = d.DEPARTMENT_ID
   HAVING SUM(e.SALARY) > 1000000
   GROUP BY d.DEPARTMENT_NAME;
   ```

5. ```sql
   SELECT d.DEPARTMENT_NAME, COUNT(e.EMPLOYEE_ID)
   FROM EMPLOYEES e
   JOIN DEPARTMENTS d ON e.DEPARTMENT_ID = d.DEPARTMENT_ID
   GROUP BY d.DEPARTMENT_NAME
   HAVING COUNT(e.EMPLOYEE_ID) > 1000000;
   ```

## 問題5
以下のテーブル構造がある場合、各部署の給与の合計が1000000を超える部署の社員数を抽出するSQL文として正しいものを1つ選びなさい。

```sql
EMPLOYEES (EMPLOYEE_ID, FIRST_NAME, LAST_NAME, SALARY, DEPARTMENT_ID)
DEPARTMENTS (DEPARTMENT_ID, DEPARTMENT_NAME)
```

1. ```sql
   SELECT d.DEPARTMENT_NAME, COUNT(e.EMPLOYEE_ID)
   FROM EMPLOYEES e
   JOIN DEPARTMENTS d ON e.DEPARTMENT_ID = d.DEPARTMENT_ID
   GROUP BY d.DEPARTMENT_NAME
   HAVING SUM(e.SALARY) > 1000000;
   ```

2. ```sql
   SELECT d.DEPARTMENT_NAME, COUNT(e.EMPLOYEE_ID)
   FROM EMPLOYEES e
   JOIN DEPARTMENTS d ON e.DEPARTMENT_ID = d.DEPARTMENT_ID
   WHERE d.DEPARTMENT_ID IN (
       SELECT DEPARTMENT_ID
       FROM EMPLOYEES
       GROUP BY DEPARTMENT_ID
       HAVING SUM(SALARY) > 1000000
   )
   GROUP BY d.DEPARTMENT_NAME;
   ```

3. ```sql
   SELECT d.DEPARTMENT_NAME, COUNT(e.EMPLOYEE_ID)
   FROM EMPLOYEES e
   JOIN DEPARTMENTS d ON e.DEPARTMENT_ID = d.DEPARTMENT_ID
   GROUP BY d.DEPARTMENT_NAME
   WHERE SUM(e.SALARY) > 1000000;
   ```

4. ```sql
   SELECT d.DEPARTMENT_NAME, COUNT(e.EMPLOYEE_ID)
   FROM EMPLOYEES e
   JOIN DEPARTMENTS d ON e.DEPARTMENT_ID = d.DEPARTMENT_ID
   HAVING SUM(e.SALARY) > 1000000
   GROUP BY d.DEPARTMENT_NAME;
   ```

SQL実践について、以下の選択肢から正しいものを1つ選びなさい。

1. パフォーマンスチューニングは、SQL文の実行速度を改善する
2. パフォーマンスチューニングは、データを更新する
3. パフォーマンスチューニングは、データを削除する
4. パフォーマンスチューニングは、データを挿入する

SQL実践について、以下の記述のうち正しいものを2つ選びなさい。

1. 実行計画は、SQL文の実行方法を表示する
2. 統計情報は、テーブルの状態を表示する
3. ヒントは、データを更新する
4. パーティションは、データを削除する
5. マテリアライズドビューは、データを挿入する

SQL実践について、以下の選択肢から正しいものを1つ選びなさい。

1. バックアップは、データを保護する
2. バックアップは、データを更新する
3. バックアップは、データを削除する
4. バックアップは、データを挿入する

<details>
<summary>答えと解説</summary>

### 答え
1. パフォーマンスチューニングは、SQL文の実行速度を改善する

### 解説
パフォーマンスチューニングの主要なポイント：
- 実行計画の確認と最適化
- インデックスの適切な使用
- 不要な全表スキャンの回避
- 適切なJOIN方法の選択
- バッチ処理の活用

</details>

<details>
<summary>答えと解説</summary>

### 答え
1. 実行計画は、SQL文の実行方法を表示する
2. 統計情報は、テーブルの状態を表示する

### 解説
SQL実践で使用する主要な機能：
- 実行計画：SQL文の実行方法とコストを表示
- 統計情報：テーブルやインデックスの状態を表示
- ヒント：オプティマイザに実行方法を指示
- パーティション：大規模テーブルの管理を効率化
- マテリアライズドビュー：問い合わせ結果を事前計算して保存

</details>

<details>
<summary>答えと解説</summary>

### 答え
1. バックアップは、データを保護する

### 解説
バックアップの種類と特徴：
- 完全バックアップ：データベース全体のバックアップ
- 増分バックアップ：前回のバックアップ以降の変更のみ
- 差分バックアップ：前回の完全バックアップ以降の変更
- オンラインバックアップ：データベース稼働中のバックアップ
- オフラインバックアップ：データベース停止中のバックアップ

</details> 