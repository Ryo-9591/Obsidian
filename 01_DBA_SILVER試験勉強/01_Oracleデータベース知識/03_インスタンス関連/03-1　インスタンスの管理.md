# インスタンス管理

## 1. インスタンスとは
Oracleデータベースを動作させるための「メモリ領域」と「プロセスの集合」です。

## 2. インスタンスの起動

### 2.1 起動手順
1. sysユーザで接続
```sql
sqlplus / as sysdba
```
2. インスタンス起動コマンドを実行
```sql
startup
```

### 2.2 起動状態
#### SHUTDOWN状態
- データベース：稼働していない
- インスタンス：稼働していない

#### NOMOUNT状態
- 初期化パラメータファイルが読み込まれ、インスタンスが起動
- SGAの割り当てとバックグラウンドプロセスの起動
- アラートログに実行の詳細が記録
- 制御ファイルの作成やデータベースの作成が可能
- 遷移コマンド：`startup nomount`

#### MOUNT状態
- 制御ファイルの読み込み
- アーカイブログモードの変更が可能
- データベース全体のリカバリ処理が可能
- 遷移コマンド：
  - `ALTER DATABASE MOUNT`（NOMOUNT状態から）
  - `startup mount`（SHUTDOWN状態から）

#### OPEN状態
- REDOログファイルとデータファイルの読み込み
- 通常ユーザの接続が可能
- 遷移コマンド：
  - `ALTER DATABASE OPEN`（MOUNT状態から）
  - `startup`（SHUTDOWN状態から）

### 2.3 接続制限
以下の状態では、特定の権限を持つユーザーのみが接続可能：
- SHUTDOWN状態
- NOMOUNT状態
- MOUNT状態

必要な権限：
- SYSDBA権限
- SYSOPER権限
- SYSBACKUP権限

## 3. インスタンスの停止

### 3.1 停止手順
1. sysユーザで接続
```sql
sqlplus / as sysdba
```
2. インスタンス停止コマンドを実行
```sql
shutdown
```

### 3.2 停止オプション

#### NORMAL
- すべてのユーザーの接続が切れるまで待機
- チェックポイントを実行してデータの整合性を確保
- 最も安全な停止方法

#### TRANSACTIONAL
- 実行中のトランザクションの完了を待機
- チェックポイントを実行してデータの整合性を確保
- トランザクションの完了を待つ必要がある場合に使用

#### IMMEDIATE
- 実行中の処理をロールバックして即時停止
- チェックポイントを実行してデータの整合性を確保
- 緊急時の停止に使用

#### ABORT
- インスタンスを強制終了
- チェックポイントを実行しない
- 次回起動時にインスタンスリカバリが必要
- 最後の手段として使用

## 4. チェックポイント
- データベースバッファキャッシュ上の変更済みブロックをデータファイルに書き込む処理
- データの整合性を確保する重要な処理
- インスタンスの停止時や定期的に実行




