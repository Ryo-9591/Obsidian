# インスタンスとは
Oracleデータベースを動かすための「メモリ領域」と「プロセスの集合」
## インスタンスの起動
①sysユーザで接続
`sqlplus / as sysdba`
②インスタンス起動コマンドを実行
`startup`
## インスタンス起動状態
### SHUTDOWN状態
・データベース稼働してない
・インスタンス稼働してない
### NOMOUNT状態
・初期化パラメータファイルが読み込まれインスタンスが起動
・アラートログに実行の詳細が記録される
・制御ファイルの作成
・データベースの作成
・インスタンス起動後SGAを割り当て、バックグラウンドプロセスが起動
・SHUTDOWN状態からは 「start nomount」で遷移
### MOUNT状態
・初期化パラメータファイル情報をもとに制御ファイルを読み込む
・アーカイブログモードへの変更
・データベース全体のリカバリ処理
・NOMOUNT状態からは「ALTER DATABASE MOUNT」で遷移
・SHUTDOWN状態からは「start mount」で遷移
### OPEN状態
・制御ファイルの情報をもとにREDOログファイルとデータファイルを読み込む
・通常ユーザの接続が可能になる
・MOUNT状態からは「ALTER DATABASE OPEN」で遷移
・SHUTDOWN状態からは「startup」で遷移

※SHUTDOWN、NOMOUNT、MOUNT状態で接続できるのは
・SYSDBA権限
・SYSOPER権限
・SYSBACKUP権限
を持つユーザのみ
## インスタンスの停止
①sysユーザで接続
`sqlplus / as sysdba` 
②インスタンス停止コマンドを実行
`shutdown`
## shutdownコマンドのオプション
### NORMAL
・すべてのユーザの接続が切られるまでインスタンスの停止をしない
・「チェックポイント」が実行されデータの整合性は保たれる
### TRANSACTIONAL
・実行中のトランザクションが完了するまでインスタンスを停止しない
・「チェックポイント」が実行されデータの整合性は保たれる
### IMMEDIATE
・実行中の処理を取り消して(ロールバック)インスタンスを終了させる
・「チェックポイント」が実行されデータの整合性は保たれる
### ABORT
・インスタンスを強制終了、何も待たない
・次回起動時にインスタンスリカバリが走る
## チェックポイント
データベースバッファキャッシュ上のすべての変更済みブロックをデータファイルに書き込む処理
# データディクショナリビューと動的パフォーマンス
Oracle内部の管理情報を確認するために用いる
## データディクショナリビュー
・データベース情報や定義情報を提供
・「データディクショナリ」という特殊な表をビューで見やすくした
・「SYSユーザ」が所有し、「SYSTEM表領域」に格納
・読み取り一貫性が保証され、OPEN状態でしかアクセスできない
### データディクショナリビューの分類
①「DBA_」から始まるデータディクショナリビュー
・データベース全体の管理情報を表示
・アクセスには権限が必要

②「ALL_」から始まるデータディクショナリビュー
・問い合わせを実行したユーザがアクセスできる範囲の管理情報を表示

③「USER_」から始まるデータディクショナリビュー
・問い合わせをしたユーザが所有する範囲の管理情報を表示
## 動的パフォーマンスビュー
・制御ファイル、SGAに格納された内部管理情報を提供
・





| 比較項目      | データディクショナリ（Data Dictionary）            | 動的パフォーマンスビュー（Dynamic Performance Views） |
| --------- | -------------------------------------- | --------------------------------------- |
| 概要        | Oracleが管理する静的な管理情報の集合                  | Oracleインスタンスの動的な状態情報の集合                 |
| ビュー名      | `USER_`, `ALL_`, `DBA_` 系              | `V$`, `GV$` 系                           |
| データの格納場所  | データディクショナリ(SYSTEM表領域SYSユーザ所有)（ベースは物理表） | 制御ファイルまたはメモリ（SGA）                       |
| 読み取り一貫性   | 保証                                     | 保証なし                                    |
| 参照可能な起動状態 | OPEN                                   | OPEN、NOMOUNT、MOUNT                      |

---
# ADR(自動診断リポジトリ)

ログを集中管理する場所。
データベースの外部に格納するためデータベースの起動状態によらずアクセスできる。
ADR：Automatic Diagnotic Repository

ADRベースに構成される。
DIAGNOSTIC_DEST初期化パラメータでADRベースのディレクトリパスを指定。

DIAGNOSTIC_DEST初期化パラメータが設定されていない場合は、
ORACLE_BASE環境変数の値か<ORACLE_HOME>/logが使用される。

ADRには、Oracle Batabaseの他にOracle Cluster、Oracle ASMなどの製品のログも管理
# アラートログ

1. インスタンスの起動終了
2. デフォルト以外の初期化パラメータ
3. すべての内部エラー
4. ブロック障害エラー
5. デッドロックエラー
6. 実行した管理コマンド(CREATE/ALTER/TABLESPACE)
7. ジョブ実行エラー
# トプロセスレースファイル

<インスタンスSID> _ <プロセス名> _ <OSプロセス番号>.trc
に記録される重大なエラー以外のログ

# PFILE、SPFILE

初期化パラメータの設定値を記載するファイル

| 項目      | **SPFILE（サーバーパラメータファイル）**          | **PFILE（初期化パラメータファイル）**          |
| ------- | ---------------------------------- | -------------------------------- |
| 形式      | バイナリ形式                             | テキスト形式                           |
| 作成元     | `CREATE SPFILE FROM PFILE` で作成可能   | `CREATE PFILE FROM SPFILE` で作成可能 |
| 編集方法    | `ALTER SYSTEM` 文で動的に変更             | 手動で直接テキスト編集                      |
| 反映タイミング | 一部は即時、再起動時も反映される                   | 再起動しないと反映されない                    |
| 格納場所    | `$ORACLE_HOME/dbs/spfile<SID>.ora` | `$ORACLE_HOME/dbs/init<SID>.ora` |

