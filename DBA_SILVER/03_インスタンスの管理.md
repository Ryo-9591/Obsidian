# インスタンスとは
Oracleデータベースを動かすための「メモリ領域」と「プロセスの集合」
## インスタンスの起動
①sysユーザで接続
`sqlplus / as sysdba`
②インスタンス起動コマンドを実行
`startup`
## インスタンス起動状態
### SHUTDOWN状態
・データベース稼働してない
・インスタンス稼働してない
### NOMOUNT状態
・初期化パラメータファイルが読み込まれインスタンスが起動
・アラートログに実行の詳細が記録される
・制御ファイルの作成
・データベースの作成
・インスタンス起動後SGAを割り当て、バックグラウンドプロセスが起動
・SHUTDOWN状態からは 「start nomount」で遷移
### MOUNT状態
・初期化パラメータファイル情報をもとに制御ファイルを読み込む
・アーカイブログモードへの変更
・データベース全体のリカバリ処理
・NOMOUNT状態からは「ALTER DATABASE MOUNT」で遷移
・SHUTDOWN状態からは「start mount」で遷移
### OPEN状態
・制御ファイルの情報をもとにREDOログファイルとデータファイルを読み込む
・通常ユーザの接続が可能になる
・MOUNT状態からは「ALTER DATABASE OPEN」で遷移
・SHUTDOWN状態からは「startup」で遷移

※SHUTDOWN、NOMOUNT、MOUNT状態で接続できるのは
・SYSDBA権限
・SYSOPER権限
・SYSBACKUP権限
を持つユーザのみ
## インスタンスの停止
①sysユーザで接続
`sqlplus / as sysdba` 
②インスタンス停止コマンドを実行
`shutdown`
## shutdownコマンドのオプション
### NORMAL
・すべてのユーザの接続が切られるまでインスタンスの停止をしない
・「チェックポイント」が実行されデータの整合性は保たれる
### TRANSACTIONAL
・実行中のトランザクションが完了するまでインスタンスを停止しない
・「チェックポイント」が実行されデータの整合性は保たれる
### IMMEDIATE
・実行中の処理を取り消して(ロールバック)インスタンスを終了させる
・「チェックポイント」が実行されデータの整合性は保たれる
### ABORT
・インスタンスを強制終了、何も待たない
・次回起動時にインスタンスリカバリが走る
## チェックポイント
データベースバッファキャッシュ上のすべての変更済みブロックをデータファイルに書き込む処理

# ADR(自動診断リポジトリ)
アラートログやトレースファイルをデータベースの外部で集中管理する場所
・データベースの起動状態によらずアクセスできる
・ADRは「Automatic Diagnotic Repository」の略
・「Oracle Cluster」、「Oracle ASM」など他の製品ログも管理可能
## ADRベース
ADRを構成する場所
・「DIAGNOSTIC_DEST初期化パラメータ」でディレクトリパスを指定
・設定されていない場合、「ORACLE_BASE環境変数」か「<ORACLE_HOME>/log」
・ADSベース配下に製品のインスタンスごとの「ADSホーム」が決定される
# アラートログ
ADSホームのtraceディレクトリに「alert_<ORACLE_SID>.log」で出力
## アラートログに出力される情報
・インスタンスの起動終了
・デフォルト以外の初期化パラメータ
・すべての内部エラー
・ブロック障害エラー
・デッドロックエラー
・実行した管理コマンド(CREATE/ALTER/TABLESPACE)
・ジョブ実行エラー
# プロセストレースファイル
ADSホームのtraceディレクトリに
「<インスタンスSID> _ <プロセス名> _ <OSプロセス番号>.trc」で出力
# SPFILE、PFILE
初期化パラメータを設定するファイル
## SPFILE(サーバパラメータファイル)
・バイナリ形式
・「ALTER SYSTEM SET文」で設定値を変更可能
・「<ORACLE_HOME>./dba/spfile<ORACLE_SID>.ora」
## PFILE
・テキスト形式
・テキストエディタで手動で編集するしかない
・「<ORACLE_HOME>/dba/init<ORACLE_SID>.ora」

※spfileとpfileが両方存在する場合spfileが優先される
# 初期化パラメータの変更
ALTER SYSTEM SET文を使用して初期化パラメータの変更ができる
## ALTER SYSTEM SET <パラメータ名> = 設定値
現行インスタンス、SPFILEに反映
## ALTER SYSTEM SET <パラメータ名> = 設定値 SCORE = SPFILE
SPFILEのみに反映→再起動時にインスタンスへ反映
## ALTER SYSTEM SET <パラメータ名> = 設定値 SCOPE = MEMORY
現行インスタンスのみに反映
※PFILE使用時は再起動しても反映されない
## ALTER SYSTEM SET <パラメータ名> = 設定値 SCORE = BOTH
現行インスタンス、SPFILEに反映
※デフォルトこれ(SPFILE使用時は)

※セッションレベルで初期化パラメータの変更をする場合は「ALTER SESSION SET文」

