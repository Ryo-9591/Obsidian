# 表領域の作成

①CREATE TABLE HR_TBS DATAFILE '[ファイルパス]' SIZE 10G;`

・ローカル管理表領域である
　「EXTENT MANAGEMET DICTIONARY」の指定がないため
　指定するとディクショナリ管理表領域

・smallfile表領域である
　「BIGFILE」の指定がないため
　データファイルを追加できる

・エクステントは均一サイズでない
　エクステントサイズの決定方法に指定がないため
　ないと自動で「AUTOALLOCATE」になるので64KB,128KBなどから自動的に決定
　均一サイズにするには「UNIFORM」を指定する必要がある

②CREATE TABLE PAYMENT_TBS;

・OMF管理である(DB_CREATE_FILEDEST初期化パラメータが設定されている)
DATAFILE句がついていないため

💡OMF管理とは・・・
データファイル名、サイズの指定が省略できる

・非OMF管理のデータファイルが追加できる
OMF管理でも非OMF管理のデータファイルは問題なく追加できる


---
# ローカル管理方式とディクショナリ管理方式の違い

## ローカル管理方式
・エクステントサイズ自動決定
・自動セグメント領域管理(ASSM)
・bigfile表領域作れる
・遅延セグメント作成
・セグメント縮小できる→「ALTER TABLE SHRINK SAPCE」で

## ディクショナリ管理方式
・いろいろできない
・「EXTENT MANAGEMET DICTIONARY」を指定したらこの管理方式になる

ローカル管理方式の方がいいし、使われている！！

---
# エクステントの割り当てタイプ２種類

## AUTOALLOCATE
・自動割り当て
・UNDO表領域は常にこれ

## UNIFORM
・均一
・一時表領域は常にこれ

---
# 表領域の種類３種類

格納できるセグメントによって名前が変わる

| 名前      | セグメント              | 備考               |
| ------- | ------------------ | ---------------- |
| 永続表領域   | 通常のセグメント・・・表やINDEX | １つ以上のデータファイルからなる |
| UNDO表領域 | UNDOセグメント・・・過去データ  | １つ以上のデータファイルからなる |
| 一時表領域   | 一時セグメント・・・一時的なデータ  | １つ以上の一時ファイルからなる  |

## 特殊な役割の永続表領域

SYSTEM表領域
・データディクショナリが格納されている
・ここに格納されているデータファイルが破損するとインスタンス異常終了
・名前は固定

SYSAUX表領域
・SYSTEM表領域の補助
・管理情報を格納
・名前は固定

---
# 表領域の削除

表領域は通常、制御ファイルとデータディクショナリに記録される

OMF管理なしで
`DROP TABLESPACE D01;`
をすると・・・

制御ファイルから消えるがデータベースディクショナリからは消えない・・・
→INCLUDING CONTENTS AND DATAFILES句を指定すると消える

---

# データファイルのブロックサイズについて

特に指定なし
デフォルトのブロックサイズ→「DB_BLOCK_SIZE初期化パラメータ」で指定

指定する
「DB_nK_CACHE_SIZE 初期化パラメータ」で指定したサイズ

---
# bigfile表領域とは

くそでかい表領域(32TB)
bibfile表領域→smallfile表領域への変更は✖

---
# データ移動のやり方２選

## オフライン移動
・ALTER TABLE 表領域名 OFFLINE;
・mvなどで移動
・ALETR TABLE 表領域名 RENAME DATAFILEでデータファイルが移動したことを認識させる 
・ALTER TABLE 表領域名 ONLINE

## オンライン移動
・ALTER **DATABASE** MOVE DATAFILE [ファイルパス(ID指定可)] TO [ファイルパス]  [REUSE];
REUSE・・・既存ファイルが存在する場合

# OMF(Oracle Managed Files)

表領域の作成と削除の際に便利

①初期化パラメータでOMF管理するデータファイルの格納先を指定(必須)
ALTER SYSTEM SET DB_CREATE_FILE_DEST='/u01/app/oracle/omf';


| 初期化パラメータ                               | 管理対象のファイル                                                                 |
| -------------------------------------- | ------------------------------------------------------------------------- |
| DB_CREATE_FILE_DEST                    | データファイル<br>一時ファイル<br>制御ファイルとREDOファイル<br>(DB_CREATE_ONLINE_LOG_DEST_nが未設定) |
| DB_CREATE_ONLINE_LOG_DEST_n(n=1,2,...) | 制御ファイルとREDOファイル                                                           |
| DB_RECOVERY_FILE_DEST                  | リカバリ関連ファイル<br>制御ファイルとREDOファイル                                             |

②データファイル名を指定せずに表領域作成

CREATE TABLESPACE omf_tbs DATAFILE SIZE100
